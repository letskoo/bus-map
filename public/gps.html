<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ê¸°ì‚¬ GPS ì „ì†¡</title>

<style>
body{font-family:sans-serif;text-align:center;padding:40px;background:#111;color:#fff;}
button{font-size:20px;padding:20px 40px;margin-top:20px;border-radius:12px;border:none;background:#00c853;color:white;}
#status{margin-top:30px;font-size:18px;color:#00e676;white-space:pre-line;}
</style>
</head>
<body>

<h1>ğŸš ê¸°ì‚¬ GPS ì „ì†¡</h1>
<div>ìš´í–‰ ì‹œì‘ ëˆ„ë¥´ë©´ ì‹¤ì‹œê°„ ì „ì†¡</div>

<button onclick="startGps()">ìš´í–‰ ì‹œì‘</button>
<button onclick="stopGps()" style="background:#d50000;">ì •ì§€</button>

<div id="status">ëŒ€ê¸°ì¤‘</div>

<script>
const SERVER = "https://bus-server-production.up.railway.app";
const ROUTE_ID = 2;

let watchId=null;

function log(t){
 document.getElementById("status").innerText=t;
 console.log(t);
}

function startGps(){
 if(!navigator.geolocation){
   log("GPS ì•ˆë¨");
   return;
 }

 log("GPS ì‹œì‘");

 watchId = navigator.geolocation.watchPosition(async(pos)=>{
   const lat=pos.coords.latitude;
   const lng=pos.coords.longitude;

   log("ì¢Œí‘œ\n"+lat+"\n"+lng+"\nì „ì†¡ì¤‘");

   try{
     const res = await fetch(SERVER+"/driver/location",{
       method:"POST",
       headers:{
         "Content-Type":"application/json"
       },
       body:JSON.stringify({
         routeId:ROUTE_ID,
         lat:lat,
         lng:lng
       })
     });

     const t = await res.text();
     log("ì „ì†¡ì™„ë£Œ\n"+lat+"\n"+lng+"\n"+t);

   }catch(e){
     log("ì „ì†¡ì‹¤íŒ¨ "+e);
   }

 },{
   enableHighAccuracy:true,
   maximumAge:0,
   timeout:10000
 },
 (err)=>{
   log("GPS ì˜¤ë¥˜ "+err.message);
 });
}

function stopGps(){
 if(watchId){
   navigator.geolocation.clearWatch(watchId);
   log("ì •ì§€");
 }
}
</script>

</body>
</html>