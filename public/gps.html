<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ê¸°ì‚¬ GPS ì „ì†¡</title>

<style>
body{font-family:sans-serif;text-align:center;padding:40px;background:#111;color:#fff;}
button{font-size:20px;padding:20px 40px;margin-top:20px;border-radius:12px;border:none;background:#00c853;color:white;}
#status{margin-top:30px;font-size:18px;color:#00e676;}
</style>
</head>
<body>

<h1>ğŸš ê¸°ì‚¬ GPS ì „ì†¡</h1>
<div>ìš´í–‰ ì‹œì‘ ëˆ„ë¥´ë©´ 5ì´ˆë§ˆë‹¤ ìœ„ì¹˜ ì „ì†¡ë¨</div>

<button onclick="startGps()">ìš´í–‰ ì‹œì‘</button>
<button onclick="stopGps()" style="background:#d50000;">ì •ì§€</button>

<div id="status">ëŒ€ê¸°ì¤‘</div>

<script>
const SERVER = "https://bus-server-production.up.railway.app";
const DRIVER_TOKEN = "HiXJVU81LrfKjOftqGuGaCTUK65KTCDA";

let watchId=null;

function startGps(){
 if(!navigator.geolocation){
   alert("GPS ì•ˆë¨");
   return;
 }

 document.getElementById("status").innerText="GPS ì‹œì‘";

 watchId = navigator.geolocation.watchPosition(async(pos)=>{
   const lat=pos.coords.latitude;
   const lng=pos.coords.longitude;

   document.getElementById("status").innerText="ì „ì†¡ì¤‘ "+lat+" "+lng;

   try{
     await fetch(SERVER+"/driver/location",{
       method:"POST",
       headers:{
         "Content-Type":"application/json",
         "x-driver-token":DRIVER_TOKEN
       },
       body:JSON.stringify({
         latitude:lat,
         longitude:lng
       })
     });
   }catch(e){
     document.getElementById("status").innerText="ì „ì†¡ì‹¤íŒ¨";
   }

 },{
   enableHighAccuracy:true,
   maximumAge:0,
   timeout:5000
 });
}

function stopGps(){
 if(watchId){
   navigator.geolocation.clearWatch(watchId);
   document.getElementById("status").innerText="ì •ì§€";
 }
}
</script>

</body>
</html>